addons:
  apt:
    update: true
    packages:
    - cppcheck
    - valgrind
    - cmake
    - libgtest-dev
    - lcov

language: cpp

before_install:
    # Установка gtest
  - cd /usr/src/gtest 
  - sudo cmake CMakeLists.txt || (cat CMakeFiles/CMakeError.log && CMakeFiles/CMakeOutput.log)
  - sudo make
  - sudo cp *.a /usr/lib
  - cd -

before_script:
  - cmake CMakeLists.txt
  - make
  - ls
    
jobs:
  include:    
    - stage: "cppcheck"
      script: cppcheck -j4 --inconclusive --enable=all --language=c main.c post.c post.h input.c input.h
      
    - stage: "memcheck"
      script: valgrind --leak-check=full -q ./PersTask1 <test.txt
      
    - stage: "gtest"
      script: ./tests_gtest
      
after_script: make clean
